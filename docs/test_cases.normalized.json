{
  "schema_version": "internal_ids_v2",
  "test_suite": "Extended EULAR/ACR 2019 SLE System Validation",
  "version": "2.0",
  "test_cases": [
    {
      "category": "1. Kiểm tra logic Miền Thận (Renal Domain - Critical Path)",
      "cases": [
        {
          "id": "TC-09",
          "description": "Sinh thiết thận là tiêu chuẩn vàng",
          "kind": "auto",
          "medical_rationale": "Theo tiêu chuẩn, chỉ riêng sinh thiết thận loại III/IV đã đủ 10 điểm để chẩn đoán nếu ANA dương tính[cite: 47].",
          "input": {
            "ana_positive": true,
            "selections": [
              "renal_biopsy_class_ii_or_v",
              "renal_biopsy_class_iii_or_iv"
            ]
          },
          "expected": {
            "total_score": 10,
            "meets_classification": true,
            "risk_tier": "SLE Tiêu chuẩn"
          }
        },
        {
          "id": "TC-10",
          "description": "Ưu tiên điểm sinh thiết hơn Protein niệu",
          "kind": "auto",
          "medical_rationale": "Áp dụng quy tắc Max-in-Domain, điểm sinh thiết cao hơn Protein niệu nên được chọn[cite: 43, 47].",
          "input": {
            "ana_positive": true,
            "selections": [
              "proteinuria",
              "renal_biopsy_class_ii_or_v"
            ]
          },
          "expected": {
            "total_score": 8,
            "domain_id": "renal",
            "domain_score": 8
          }
        }
      ]
    },
    {
      "category": "2. Kiểm tra Miền Miễn dịch & Bổ thể (Immunologic Domains)",
      "cases": [
        {
          "id": "TC-11",
          "description": "Logic cộng dồn miền Bổ thể",
          "kind": "auto",
          "medical_rationale": "Nếu giảm cả C3 VÀ C4, điểm miền bổ thể là 4 thay vì 3 (Max-in-Domain đặc biệt)[cite: 48].",
          "input": {
            "ana_positive": true,
            "selections": [
              "low_c3_and_c4"
            ]
          },
          "expected": {
            "domain_id": "complement",
            "domain_score": 4
          }
        },
        {
          "id": "TC-12",
          "description": "Kháng thể Antiphospholipid (Không cộng dồn)",
          "kind": "auto",
          "medical_rationale": "Bất kỳ kháng thể Antiphospholipid nào dương tính cũng chỉ tính 2 điểm cho cả miền[cite: 48].",
          "input": {
            "ana_positive": true,
            "selections": [
              "antiphospholipid_any"
            ]
          },
          "expected": {
            "domain_id": "antiphospholipid",
            "domain_score": 2
          }
        }
      ]
    },
    {
      "category": "3. Kiểm tra Ngưỡng Biên Phân tầng Nguy cơ (Ominosity Thresholds)",
      "cases": [
        {
          "id": "TC-13",
          "description": "Ngưỡng cận biên không bị SLE (9 điểm)",
          "kind": "auto",
          "medical_rationale": "Tổng điểm dưới 10 chưa đủ tiêu chuẩn phân loại SLE[cite: 49, 64].",
          "input": {
            "ana_positive": true,
            "selections": [
              "acute_pericarditis",
              "leukopenia"
            ]
          },
          "expected": {
            "total_score": 9,
            "meets_classification": false,
            "risk_tier": "Chưa đủ tiêu chuẩn"
          }
        },
        {
          "id": "TC-14",
          "description": "Ngưỡng cận biên Ominous (19 điểm)",
          "kind": "auto",
          "medical_rationale": "Tổng điểm 19 vẫn thuộc nhóm nguy cơ tiêu chuẩn, chưa chạm ngưỡng cảnh báo đỏ[cite: 65].",
          "input": {
            "ana_positive": true,
            "selections": [
              "joint_involvement",
              "renal_biopsy_class_ii_or_v",
              "seizure"
            ]
          },
          "expected": {
            "total_score": 19,
            "meets_classification": true,
            "risk_tier": "SLE Tiêu chuẩn"
          }
        }
      ]
    },
    {
      "category": "4. Kiểm tra Logic Thần kinh & Tâm thần (Neuropsychiatric)",
      "cases": [
        {
          "id": "TC-15",
          "description": "Quy tắc Max-in-Domain cho biểu hiện thần kinh nặng",
          "kind": "auto",
          "medical_rationale": "Chỉ tính 5 điểm cho biểu hiện nặng nhất (Co giật) trong miền thần kinh tâm thần[cite: 43, 47].",
          "input": {
            "ana_positive": true,
            "selections": [
              "delirium",
              "psychosis",
              "seizure"
            ]
          },
          "expected": {
            "total_score": 5,
            "domain_id": "neuropsychiatric",
            "domain_score": 5
          }
        }
      ]
    },
    {
      "category": "5. Kiểm tra Kỹ thuật & Hệ thống (Technical & Integration)",
      "cases": [
        {
          "id": "TC-16",
          "description": "Xử lý dữ liệu rỗng (Null/Empty Submission)",
          "kind": "auto",
          "technical_logic": "Hệ thống phải trả về 0 điểm thay vì lỗi logic khi không có triệu chứng nào được chọn[cite: 109, 132].",
          "input": {
            "ana_positive": true,
            "selections": []
          },
          "expected": {
            "total_score": 0
          }
        },
        {
          "id": "TC-17",
          "description": "Tính toàn vẹn của Docker Container",
          "kind": "manual",
          "technical_logic": "Đảm bảo tính tái lập của môi trường nghiên cứu thông qua ảo hóa[cite: 144, 146].",
          "action": "docker-compose up"
        }
      ]
    },
    {
      "category": "6. Kiểm tra Da-niêm mạc, Thanh mạc, Hiến pháp (Mucocutaneous/Serosal/Constitutional)",
      "cases": [
        {
          "id": "TC-18",
          "description": "Max-in-Domain Da-niêm mạc: ưu tiên Lupus da cấp tính (6 điểm)",
          "kind": "auto",
          "medical_rationale": "Trong cùng miền Da-niêm mạc chỉ tính điểm cao nhất; Lupus da cấp tính có trọng số 6 điểm nên được chọn (Max-in-Domain).",
          "warnings": [
            "expected_output.domain_score có nhưng không suy ra được domain_id."
          ],
          "input": {
            "ana_positive": true,
            "selections": [
              "acute_cutaneous",
              "nonscarring_alopecia",
              "subacute_cutaneous_or_discoid"
            ]
          },
          "expected": {
            "total_score": 6,
            "domain_score": 6
          }
        },
        {
          "id": "TC-19",
          "description": "Max-in-Domain Thanh mạc: ưu tiên Viêm màng ngoài tim cấp (6 điểm) hơn tràn dịch (5 điểm)",
          "kind": "auto",
          "medical_rationale": "Miền Thanh mạc áp dụng Max-in-Domain, chọn điểm cao nhất là 6.",
          "warnings": [
            "expected_output.domain_score có nhưng không suy ra được domain_id."
          ],
          "input": {
            "ana_positive": true,
            "selections": [
              "acute_pericarditis",
              "pleural_or_pericardial_effusion"
            ]
          },
          "expected": {
            "total_score": 6,
            "domain_score": 6
          }
        },
        {
          "id": "TC-20",
          "description": "Miền Hiến pháp: Sốt (2 điểm) đơn trị",
          "kind": "auto",
          "medical_rationale": "Miền Hiến pháp chỉ có tiêu chí Sốt, tính 2 điểm.",
          "warnings": [
            "expected_output.domain_score có nhưng không suy ra được domain_id."
          ],
          "input": {
            "ana_positive": true,
            "selections": [
              "fever"
            ]
          },
          "expected": {
            "total_score": 2,
            "domain_score": 2
          }
        }
      ]
    },
    {
      "category": "7. Kiểm tra Huyết học, Bổ thể, Kháng thể đặc hiệu (Hematologic/Complement/SLE-specific Abs)",
      "cases": [
        {
          "id": "TC-21",
          "description": "Max-in-Domain Huyết học: Giảm tiểu cầu (4) ưu tiên hơn Giảm bạch cầu (3)",
          "kind": "auto",
          "medical_rationale": "Trong miền Huyết học chỉ lấy điểm cao nhất (4).",
          "warnings": [
            "expected_output.domain_score có nhưng không suy ra được domain_id."
          ],
          "input": {
            "ana_positive": true,
            "selections": [
              "leukopenia",
              "thrombocytopenia"
            ]
          },
          "expected": {
            "total_score": 4,
            "domain_score": 4
          }
        },
        {
          "id": "TC-22",
          "description": "Bổ thể mức nhẹ: chỉ giảm C3 hoặc C4 (3 điểm)",
          "kind": "auto",
          "medical_rationale": "Giảm C3 hoặc C4 tính 3 điểm; nếu giảm cả hai mới là 4 điểm.",
          "input": {
            "ana_positive": true,
            "selections": [
              "low_c3_or_c4"
            ]
          },
          "expected": {
            "total_score": 3,
            "domain_id": "complement",
            "domain_score": 3
          }
        },
        {
          "id": "TC-23",
          "description": "Kháng thể đặc hiệu SLE: Anti-dsDNA hoặc Anti-Sm (6 điểm)",
          "kind": "auto",
          "medical_rationale": "Miền kháng thể đặc hiệu SLE là đơn trị: chỉ cần 1 trong 2 dương tính được 6 điểm.",
          "warnings": [
            "expected_output.domain_score có nhưng không suy ra được domain_id."
          ],
          "input": {
            "ana_positive": true,
            "selections": [
              "anti_dsdna_or_anti_sm"
            ]
          },
          "expected": {
            "total_score": 6,
            "domain_score": 6
          }
        }
      ]
    },
    {
      "category": "8. Kiểm tra ngưỡng phân loại & Ominous + ANA gate",
      "cases": [
        {
          "id": "TC-24",
          "description": "Đúng ngưỡng phân loại 10 điểm (6+2+2): Viêm khớp + sốt + APL",
          "kind": "auto",
          "medical_rationale": "Tổng điểm đạt 10 là đủ tiêu chuẩn phân loại SLE.",
          "input": {
            "ana_positive": true,
            "selections": [
              "antiphospholipid_any",
              "fever",
              "joint_involvement"
            ]
          },
          "expected": {
            "total_score": 10,
            "meets_classification": true,
            "risk_tier": "SLE Tiêu chuẩn"
          }
        },
        {
          "id": "TC-25",
          "description": "Đúng ngưỡng Ominous 20 điểm (10+6+2+2): Thận III/IV + viêm khớp + APL + sốt",
          "kind": "auto",
          "medical_rationale": "Ngưỡng 20 được xem là nhóm nguy cơ cao (Ominous) trong mô hình phân tầng.",
          "input": {
            "ana_positive": true,
            "selections": [
              "antiphospholipid_any",
              "fever",
              "joint_involvement",
              "renal_biopsy_class_ii_or_v",
              "renal_biopsy_class_iii_or_iv"
            ]
          },
          "expected": {
            "total_score": 20,
            "meets_classification": true,
            "risk_tier": "SLE Nguy cơ cao / Ominous"
          }
        },
        {
          "id": "TC-26",
          "description": "ANA âm tính: dù có nhiều tiêu chí vẫn không đủ điều kiện tính điểm",
          "kind": "auto",
          "medical_rationale": "Theo tiêu chuẩn EULAR/ACR 2019, ANA là điều kiện đầu vào; ANA âm tính thì dừng, không cộng điểm.",
          "input": {
            "ana_positive": false,
            "selections": [
              "acute_cutaneous",
              "joint_involvement",
              "renal_biopsy_class_ii_or_v",
              "renal_biopsy_class_iii_or_iv"
            ]
          },
          "expected": {
            "total_score": 0,
            "meets_classification": false,
            "risk_tier": "Chưa đủ tiêu chuẩn"
          }
        }
      ]
    }
  ]
}
